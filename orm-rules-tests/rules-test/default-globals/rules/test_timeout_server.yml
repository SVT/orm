---

schema_version: 1

rules:
  - description: Test slow backend with default server timeout
    domains:
      - test
    matches:
      all:
        - paths:
            exact:
              - '/backend/timeout_server_default'
    actions:
      backend:
        origin: 'http://127.0.0.1:4242'


tests:
  - name: 'Test that server responds'
    request:
      url: 'https://test/backend/timeout_server_default?sleep=0'
    expect:
      status: 200
      time_max: 2
  - name: 'Test that default server timeout strikes after 15s when not set in global haproxy config'
    request:
      url: 'https://test/backend/timeout_server_default?sleep=20'
    expect:
      status: 504
      time_min: 15
      time_max: 17
